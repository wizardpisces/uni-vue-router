!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],e):e((t=t||self).UniAppRouter={},t._Vue)}(this,function(t,e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var r={push:"navigateTo",pushTab:"switchTab",replace:"redirectTo",replaceAll:"reLaunch",back:"navigateBack"},o="-";function i(t){void 0===t&&(t="");var e="",n="",r=t.indexOf("#");r>=0&&(e=t.slice(r),t=t.slice(0,r));var o=t.indexOf("?");return o>=0&&(n=t.slice(o+1),t=t.slice(0,o)),{path:t,query:n,hash:e}}function a(t){return t.replace(/^\/|\/$/g,"")}var u=function(){function t(t){var e;(this._routeTable=[],t.pagesJSON)&&(t.pagesJSON="string"==typeof(e=t.pagesJSON)?JSON.parse(e):JSON.parse(JSON.stringify(e)),this._routeTable=function(t){function e(t,e){return void 0===e&&(e=""),t.reduce(function(t,n){var r;return n.path=a(n.path),e&&(n.path=e+"/"+n.path),n.name||(n.name=a(n.path).split("/").join(o)),n.path="/"!==(r=n.path)[0]?"/"+r:r,t.push(n),t},[])}var n=e(t.pages);t.subPackages&&(n=n.concat(t.subPackages.reduce(function(t,n){return t.concat(e(n.pages,n.root))},[])));return console.log("[router config generated from pages.json]:",n),n}(t.pagesJSON))}return t.prototype.resolvePathByName=function(t){var e=this._routeTable.filter(function(e){return t===e.name});return e&&e[0].path},t.prototype.resolveNameByPath=function(t){var e=this._routeTable;t=i(t).path;var n=e.filter(function(e){return n=t,r=e.path,a(n)===a(r);var n,r});return n&&n[0].name},t}();var c=!1,s=function(t){return void 0!==t};function p(t){if(!c||e!==t){c=!0;var n={_router:{},_route:{}};t.mixin({beforeCreate:function(){if(s(this.$options.router)){var e=this.$options.router;n._router=e,n._router.init(n),t.util.defineReactive(n,"_route",e.current)}}}),Object.defineProperty(t.prototype,"$router",{get:function(){return n._router}}),Object.defineProperty(t.prototype,"$route",{get:function(){return n._route}})}}var f=/[!'()*]/g,h=function(t){return"%"+t.charCodeAt(0).toString(16)},l=/%2C/g,y=function(t){return encodeURIComponent(t).replace(f,h).replace(l,",")},v=decodeURIComponent;function d(t){var e={};return(t=t.trim().replace(/^(\?|#|&)/,""))?(t.split("&").forEach(function(t){var n=t.replace(/\+/g," ").split("="),r=v(n.shift()),o=n.length>0?v(n.join("=")):null;void 0===e[r]?e[r]=o:Array.isArray(e[r])?e[r].push(o):e[r]=[e[r],o]}),e):e}function m(t){var e={name:t.name,path:t.path||"/",query:t.query||{}};return Object.freeze(e)}var g=m({path:"/"});var b=function(t){(function(t){return Object.prototype.toString.call(t).indexOf("Error")>-1})(t)&&console.error(t)};function k(t,e){return t.push(e),function(){var n=t.indexOf(e);n>-1&&t.splice(n,1)}}var P=function(t){function e(e){var n=t.call(this,e)||this;return n.navigationMethodName="",n}return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e.prototype.pushTab=function(t,e,n){var o=this;if(!e&&!n&&"undefined"!=typeof Promise)return new Promise(function(e,n){o.pushTab(t,e,n)});this.transitionTo(t,function(t){uni[r.pushTab]({url:""+t.pathname+t.search,success:t.onCompleteProxy(function(){o.navigationMethodName="pushTab",o.stack=[t.route],o.index=0,e&&e()}),fail:n})})},e.prototype.push=function(t,e,n){var o=this;if(!e&&!n&&"undefined"!=typeof Promise)return new Promise(function(e,n){o.push(t,e,n)});this.transitionTo(t,function(t){uni[r.push]({url:""+t.pathname+t.search,success:t.onCompleteProxy(function(){o.navigationMethodName="push",o.pushStack(t.route),e&&e()}),fail:n})})},e.prototype.replace=function(t,e,n){var o=this;if(!e&&!n&&"undefined"!=typeof Promise)return new Promise(function(e,n){o.replace(t,e,n)});this.transitionTo(t,function(t){uni[r.replace]({url:""+t.pathname+t.search,success:t.onCompleteProxy(function(){o.navigationMethodName="replace",o.stack=o.stack.slice(0,o.index).concat(t.route),e&&e()}),fail:n})})},e.prototype.replaceAll=function(t,e,n){var o=this;if(!e&&!n&&"undefined"!=typeof Promise)return new Promise(function(e,n){o.replaceAll(t,e,n)});this.transitionTo(t,function(t){uni[r.replaceAll]({url:""+t.pathname+t.search,success:t.onCompleteProxy(function(){o.navigationMethodName="replaceAll",o.stack=[t.route],o.index=0,e&&e()}),fail:n})})},e.prototype.back=function(t){void 0===t&&(t=1),this.go(-t)},e.prototype.go=function(t){var e=this;void 0===t&&(t=0);uni[r.back]({delta:-t});var n=this.index+t;if(n<0||n>=this.stack.length)return this.index,void this.stack;var o=this.stack[n];return this.transitionTo(o,function(t){t.onCompleteProxy(function(){e.navigationMethodName="back",e.stack=e.stack.slice(0,n+1),e.index=n})})},e}(function(){function t(t){this.maxStackSize=50,this.cb=function(t){},this.options=t,this.stack=[],this.index=-1,this.beforeHooks=[],this.afterHooks=[],this.current=g,this.routeMap=new u(t)}return t.prototype.go=function(t){},t.prototype.push=function(t,e,n){},t.prototype.replace=function(t,e,n){},t.prototype.resolveBeforeHooks=function(t,e){var n,r,o,i;n=this.beforeHooks,r=t,o=function(){e()},(i=function(t){t>=n.length?o():n[t]?r(n[t],function(){i(t+1)}):i(t+1)})(0)},t.prototype.resolve=function(t){"string"==typeof t?t={path:t}:!t.path&&t.name?t.path=this.routeMap.resolvePathByName(t.name):t.path&&!t.name&&(t.name=this.routeMap.resolveNameByPath(t.path)),!t.path&&t.name;var e,n,r=i(t.path),o=function(t,e,n){void 0===e&&(e={});var r,o=n||d;try{r=o(t||"")}catch(t){t.message,r={}}for(var i in e){var a=e[i];r[i]=Array.isArray(a)?a.slice():a}return r}(r.query,t.query),a=(n=(e=o)?Object.keys(e).map(function(t){var n=e[t];if(void 0===n)return"";if(null===n)return y(t);if(Array.isArray(n)){var r=[];return n.forEach(function(e){void 0!==e&&(null===e?r.push(y(t)):r.push(y(t)+"="+y(e)))}),r.join("&")}return y(t)+"="+y(n)}).filter(function(t){return t.length>0}).join("&"):null)?"?"+n:"";return{name:t.name,path:r.path,hash:r.hash,pathname:r.path,search:a,query:o}},t.prototype.transitionTo=function(t,e){var n=this,r=this.resolve(t),o=m(r),i=this.current;this.resolveBeforeHooks(function(t,e){try{t(o,i,function(t){"string"==typeof t||"object"==typeof t&&("string"==typeof t.path||"string"==typeof t.name)?(b(),"object"==typeof t&&t.replace?n.replace(t):n.push(t)):e(t)})}catch(t){b(t)}},function(){e?e({route:o,pathname:r.pathname,search:r.search,onCompleteProxy:function(t){return function(){t&&t(),n.updateRoute(o)}}}):(n.updateRoute(o),n.pushStack(o))})},t.prototype.pushStack=function(t){this.stack=this.stack.slice(0,this.index+1).concat(t).slice(-this.maxStackSize),this.index++},t.prototype.updateRoute=function(t){var e=this.current;this.current=t,this.cb&&this.cb(t),this.afterHooks.forEach(function(n){n&&n(t,e)})},t.prototype.beforeEach=function(t){return k(this.beforeHooks,t)},t.prototype.afterEach=function(t){return k(this.afterHooks,t)},t.prototype.listen=function(t){this.cb=t},t.prototype.init=function(t){this.listen(function(e){t._route=e})},t.install=p,t}());t.default=P,Object.defineProperty(t,"__esModule",{value:!0})});
